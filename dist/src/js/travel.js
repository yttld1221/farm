"use strict";function TraLeftGetData(){var e=sessionStorage.getItem("str_search");if(null==e){getPHP("src/php/query.php?sql=SELECT * FROM travel ORDER BY id DESC").then(function(e){PageSize(JSON.parse(e))},function(e){console.error("出错了",e)})}else{getPHP("src/php/query.php?sql="+("SELECT * FROM travel WHERE title LIKE '%"+e+"%'")).then(function(e){PageSize(JSON.parse(e))},function(e){console.error("出错了",e)})}}function LeftSlice(e){for(var t="",n=0;n<e.length;n++)t+='\n        <div class="row clearfix TextBox">\n            \x3c!-- 图片 --\x3e\n            <div class="col-md-3 column TextBox-img">\n                <a href=\'travel_Detail.html?id='+e[n].id+'\'><img class="img" src="src/img/travel/'+e[n].img+'"/></a>\n            </div>\n            \x3c!-- 文章 --\x3e\n            <div class="col-md-9 column TextBox-text">\n                \x3c!-- 标题 --\x3e\n                <h3>\t\n                    <a href=\'travel_Detail.html?id='+e[n].id+"'>"+e[n].title+"</a>\n                </h3>\n                \x3c!-- 描述 --\x3e\n                <p>\n                "+e[n].intro+'\n                </p>\n                \x3c!-- 浏览数量 --\x3e\n                <ul class="list-unstyled">\n                    <li>\n                    '+e[n].time+"\n                    </li>\n                    <li>\n                    "+e[n].username+'\n                    </li>\n                    <li>\n                        <span class="glyphicon glyphicon-eye-open lookNum">'+e[n].num+"</span>\n                    </li>\n                </ul>\n            </div>\n        </div>\n        ";$("#pageMain").html(t),Look()}function PageSize(e){LeftSlice(e),$(function(){!function(t){for(var n=$(t.pageMain),i=$(t.pageNav),e=$(t.pagePrev),a=$(t.pageNext),r=t.curNum,o=Math.ceil(n.find(">div").length/r),s="",l=0,c=0;c<o;c++)s+='<a href="javascript:;">'+(c+1)+"</a>";i.html(s),i.find("a:first").addClass(t.activeClass),i.find("a").each(function(){$(this).click(function(){i.find("a").removeClass(t.activeClass),$(this).addClass(t.activeClass),l=$(this).index(),$(n).find(">div").hide();for(var e=($(this).html()-1)*r;e<$(this).html()*r;e++)$(n).find(">div").eq(e).show()})}),$(n).find(">div").hide();for(var c=0;c<r;c++)$(n).find(">div").eq(c).show();a.click(function(){if($(n).find(">div").hide(),l==o-1){alert("已经是最后一页");for(var e=(o-1)*r;e<o*r;e++)$(n).find(">div").eq(e).show();return!1}i.find("a").removeClass(t.activeClass),l++,i.find("a").eq(l).addClass(t.activeClass);for(var e=l*r;e<(l+1)*r;e++)$(n).find(">div").eq(e).show()}),e.click(function(){if($(n).find(">div").hide(),0==l){alert("当前是第一页");for(var e=0;e<r;e++)$(n).find(">div").eq(e).show();return!1}i.find("a").removeClass(t.activeClass),l--,i.find("a").eq(l).addClass(t.activeClass);for(var e=l*r;e<(l+1)*r;e++)$(n).find(">div").eq(e).show()})}({pageMain:"#pageMain",pageNav:"#pageNav",pagePrev:"#prev",pageNext:"#next",curNum:4,activeClass:"active",ini:0})})}function Look(){for(var i=$(".TextBox-img img"),a=$(".TextBox-text h3"),e=function(n){i[n].onclick=function(){var e=$(".lookNum").eq(n).text();e++;var t=i[n].parentNode.href.split("=")[1];upData(e,t),TraLeftGetData()},a[n].onclick=function(){var e=$(".lookNum").eq(n).text();e++;var t=a[n].children[0].href.split("=")[1];upData(e,t),TraLeftGetData()}},t=0;t<i.length;t++)e(t)}TraLeftGetData();var upData=function(e,t){$.ajax({type:"POST",url:"src/php/updata.php",data:{lookNum:e,id:t},dataType:"text",success:function(e){console.log(e)},error:function(){console.log("error")}})};function TraRightGetData(){getPHP("src/php/query.php?sql=SELECT * FROM travel ORDER BY num DESC LIMIT 3").then(function(e){RightSlice(JSON.parse(e))},function(e){console.error("出错了",e)})}function RightSlice(e){for(var t="",n=0;n<e.length;n++)t+='\n        <li>\n            <a href="travel_Detail.html?id='+e[n].id+'">'+e[n].title+"</a>\n        </li>\n        ";$(".recommend .list-unstyled").html(t)}function Share(){$(function(){$("#shareBtn").on("click",function(){if("未登录"==$("#username").text()){if(!confirm("您还未登陆账号！\n请先登陆！"))return!1;location.href="login.html"}else location.href="share.html"})})}function User(){$(function(){$("img.img-circle").on("click",function(){"未登录"==$("#username").text()?$(this).parent().attr("href","login.html"):$(this).parent().attr("href","user.html")}),$("#username").on("click",function(){"未登录"==$(this).text()?$(this).parent().attr("href","login.html"):$(this).parent().attr("href","user.html")})})}function UsernameShow(){$(function(){null!=sessionStorage.getItem("username")?($("#username").text(sessionStorage.getItem("username")),$("#username").css({color:"#77d1ad",fontSize:"18px"}),$("#logout").show()):($("#username").text("未登录"),$("#logout").hide())})}function Logout(){$(function(){$("#logout").on("click",function(){sessionStorage.removeItem("username"),$("#username").text("未登录"),$("#username").css({color:"#a94442",fontSize:"15px"}),$(this).hide()})})}function tra_sea(){$(function(){var e=window.sessionStorage.getItem("str_search");getPHP("src/php/query.php?sql="+("SELECT * FROM travel WHERE title LIKE '%"+e+"%'")).then(function(e){PageSize(JSON.parse(e))},function(e){console.error("出错了",e)})})}function ClearTitle(){$(function(){$("#nav a").click(function(){window.sessionStorage.removeItem("str_search")})})}TraRightGetData(),Share(),User(),UsernameShow(),Logout(),ClearTitle();