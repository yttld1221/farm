"use strict";function ordercolor(){$("input").on("click",function(){$(this).parent(".us-item").addClass("input-on").siblings().removeClass("input-on")}),$("select").on("click",function(){$(this).parent(".us-item").addClass("input-on").siblings().removeClass("input-on")}),$("textarea").on("click",function(){$(this).parent(".us-item").addClass("input-on").siblings().removeClass("input-on")})}function ordersubmit(){$("#orderbtn").on("click",function(){var a=$("select option:selected").text(),r=$("input[type=text]").eq(0).val(),s=$("input[type=text]").eq(1).val(),i=$("input[type=text]").eq(2).val(),o=$(".start_time").val(),l=$(".end_time").val(),d=order_time(o);window.sessionStorage.setItem("start_day",d);var m=order_time(l);window.sessionStorage.setItem("end_day",m);var c=$("textarea").val();""!=a&&""!=r&&""!=s&&""!=i&&""!=o&&""!=l?getPHP("src/php/query.php?sql="+('SELECT * FROM make WHERE name="'+r+'" or tel="'+s+'"')).then(function(e){var t=JSON.parse(e);if(0<t.length){if(t[0].name==r&&t[0].tel!=s)alert("游客"+t[0].name+"，您已使用号码"+t[0].tel+"预约成功，时间为 "+t[0].start_day+" 至 "+t[0].end_day+"！"),window.location.reload();else if(t[0].name!=r&&t[0].tel==s)alert("号码"+t[0].tel+"，已被游客"+t[0].name+"进行预约，时间为 "+t[0].start_day+" 至 "+t[0].end_day+" ！"),window.location.reload();else if(t[0].name==r&&t[0].tel==s)if(t[0].start_time>=d&&t[0].end_time<=m||t[0].start_time<=d&&t[0].end_time>=m||t[0].start_time<=d&&t[0].end_time>=d||t[0].start_time<=m&&t[0].end_time>=m||t[0].start_time>=d&&t[0].start_time>=m)alert("游客"+t[0].name+"，您的预约时间为 "+t[0].start_day+" 至 "+t[0].end_day+",不得重复预约！"),window.location.reload();else{var n='UPDATE make SET make_name="'+a+'",people_num='+i+',start_time="'+d+'",end_time="'+m+'",note="'+c+'",start_day="'+o+'",end_day="'+l+'" WHERE name="'+t[0].name+'"';getPHP("src/php/querya.php?sql="+n).then(function(e){alert("游客"+t[0].name+"，您预约日期已失效,新的预约时间为 "+o+" 至 "+l+" ,望您如期而至体验！"),window.location.reload()})}}else getPHP("src/php/querya.php?sql="+('INSERT INTO make(make_name,name,tel,people_num,start_time,end_time,note,start_day,end_day) VALUES("'+a+'","'+r+'","'+s+'",'+i+',"'+d+'","'+m+'","'+c+'","'+o+'","'+l+'")')).then(function(e){alert("恭喜游客"+r+",您已预约成功！"),window.location.reload()})}):(alert("预约信息不得为空,请重新填写。"),window.location.reload())})}function order_time(e){return window.sessionStorage.setItem("order_time",e),order_day(e.split("-")[1],e.split("-")[2])}function order_day(e,t){switch(e){case"01":return t;case"02":return 31+parseInt(t);case"03":return 59+parseInt(t);case"04":return 90+parseInt(t);case"05":return 120+parseInt(t);case"06":return 151+parseInt(t);case"07":return 181+parseInt(t);case"08":return 212+parseInt(t);case"09":return 243+parseInt(t);case"10":return 273+parseInt(t);case"11":return 304+parseInt(t);case"12":return 334+parseInt(t)}}ordercolor(),ordersubmit();